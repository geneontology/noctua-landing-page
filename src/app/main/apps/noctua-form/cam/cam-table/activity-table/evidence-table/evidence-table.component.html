<div class="noc-evidence-table noctua-form-table w-100-p">
  <table *ngIf="entity.predicate?.evidence.length>0" mat-table fxFlex="1 1 auto" class="w-100-p" #table
    [dataSource]="entity.predicate?.evidence">
    <ng-container matColumnDef="evidence">
      <td class="noc-evidence-code-cell" mat-cell *matCellDef="let evidence; let i = index;" fxFlex="" fxLayout="column"
        fxLayoutAlign="start stretch" [ngClass]="{'noc-highlight-modified': evidence.evidence?.modified}">
        <span class="noc-old-term" *ngIf="evidence.evidence?.modified && evidence.evidence?.termHistory?.length>0">
          {{evidence.evidence?.termHistory[0]?.label}}
          <a (click)="$event.stopPropagation()" href="{{evidence.evidence?.termHistory[0]?.url}}" target="_blank">
            {{ evidence.evidence?.termHistory[0]?.id }}
          </a>
        </span>
        <span class="">{{evidence.evidence?.label}}<br>
          <a (click)="$event.stopPropagation()" href="{{evidence.evidence?.url}}" target="_blank">
            {{ evidence.evidence?.id }}
          </a>
        </span>
        <noctua-inline-editor *ngIf="noctuaUserService.user && options.editableEvidence" [cam]="cam"
          [activity]='activity' [entity]="entity" [category]="EditorCategory.evidence" [evidenceIndex]="i"
          class="noc-edit-button">
        </noctua-inline-editor>
      </td>
    </ng-container>
    <ng-container matColumnDef="reference">
      <td class="noc-reference-cell" mat-cell *matCellDef="let evidence; let i = index" fxLayout="column"
        fxLayoutAlign="start stretch" [ngClass]="{'noc-highlight-match': evidence.referenceEntity?.highlight,
            'noc-highlight-modified': evidence.referenceEntity?.modified,
            'noc-highlight-match-current': evidence.referenceEntity?.uuid===camsService.currentMatch?.uuid}">
        <span class="noc-old-term"
          *ngIf="evidence.referenceEntity?.modified && evidence.referenceEntity?.termHistory?.length>0">
          <a (click)="$event.stopPropagation()" href="{{evidence.referenceEntity?.termHistory[0]?.url}}"
            target="_blank">
            {{ evidence.referenceEntity?.termHistory[0]?.id }}
          </a>
        </span>
        <span *ngIf="!evidence.referenceEntity?.url" class="">{{evidence.reference}}</span>
        <span *ngIf="evidence.referenceEntity?.url" class="">
          <a (click)="$event.stopPropagation()" href="{{evidence.referenceEntity?.url}}" target="_blank">
            {{evidence.reference}}
          </a>
        </span>
        <noctua-inline-editor *ngIf="noctuaUserService.user && options.editableReference" [cam]="cam"
          [activity]='activity' [entity]="entity" [category]="EditorCategory.reference" [evidenceIndex]="i"
          class="noc-edit-button">
        </noctua-inline-editor>
      </td>
    </ng-container>
    <ng-container matColumnDef="with">
      <td class="noc-with-cell" mat-cell *matCellDef="let evidence; let i = index;" fxLayout="column"
        fxLayoutAlign="start stretch" [ngClass]="{'noc-highlight-modified': evidence.withEntity?.modified}">
        <span class="noc-old-term" *ngIf="evidence.withEntity?.modified && evidence.withEntity?.termHistory?.length>0">
          <a (click)="$event.stopPropagation()" href="{{evidence.withEntity?.termHistory[0]?.url}}" target="_blank">
            {{ evidence.withEntity?.termHistory[0]?.id }}
          </a>
        </span>
        <span *ngIf="!evidence.withEntity?.url" class="">{{evidence.with}}</span>
        <span *ngIf="evidence.withEntity?.url" class="">
          <a (click)="$event.stopPropagation()" href="{{evidence.withEntity?.url}}" target="_blank">
            {{evidence.with}}
          </a>
        </span>
        <noctua-inline-editor *ngIf="noctuaUserService.user && options.editableWith" [cam]="cam" [activity]='activity'
          [entity]="entity" [category]="EditorCategory.with" [evidenceIndex]="i" class="noc-edit-button">
        </noctua-inline-editor>
      </td>
    </ng-container>
    <ng-container matColumnDef="assignedBy">
      <td class="noc-group-cell" mat-cell *matCellDef="let evidence; let i = index;" fxLayout="column"
        fxLayoutAlign="start stretch">
        <span class="">
          <span *ngFor="let group of evidence.groups; let i=index; let isLast=last">
            <a (click)="$event.stopPropagation()" href="{{group.url}}" target="_blank">
              {{group.name}}
            </a>
            <span *ngIf="!isLast">&#44;&nbsp;</span>
          </span>
        </span>
      </td>
    </ng-container>
    <ng-container matColumnDef="contributor">
      <td class="noc-contributor-cell" mat-cell *matCellDef="let evidence; let i = index;" fxLayout="column"
        fxLayoutAlign="start stretch">
        <span class="">
          <span *ngFor="let contributor of evidence.contributors; let i=index; let isLast=last">
            <a (click)="$event.stopPropagation()" href="{{contributor.urcid}}" target="_blank">
              {{contributor.name}}
            </a>
            <span *ngIf="!isLast">&#44;&nbsp;</span>
          </span>
        </span>
      </td>
    </ng-container>
    <tr mat-row *matRowDef="let evidence; columns: displayedColumns;" class="" matRipple></tr>
  </table>
  <div *ngIf="entity.predicate?.evidence.length===0" class="noc-no-info">
    no evidence present.
  </div>
</div>